(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     50872,       1213]
NotebookOptionsPosition[     48344,       1169]
NotebookOutlinePosition[     48779,       1186]
CellTagsIndexPosition[     48736,       1183]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["\<\
How to plot a rank - 2 tensor (e.g. polarizability, optical rotation, EFG or \
shielding) with a molecule

for Mathematica versions up to 11.3\
\>", "Subsubsection",
 CellChangeTimes->{{3.415567572828125*^9, 3.415567577109375*^9}, {
  3.4155676201875*^9, 3.415567640015625*^9}, {3.415638375515625*^9, 
  3.4156383819375*^9}, {3.773069403452569*^9, 
  3.773069418065445*^9}},ExpressionUUID->"66c2ffc7-bd8c-4984-b79e-\
6eec20a09d77"],

Cell["\<\
\[Copyright] 2014 J. Autschbach, University at Buffalo, SUNY. You may use and \
modify this notebookfor your research  as long as this copyright statement \
remains intact. Other uses and redistribution of the original or a modified \
version are not permitted. If in doubt, contact the author.
The author does not warrant correct functioning of the code and is not liable \
for any damages or any other causes whatsoever resulting from the use of this \
software. 

If you use this notebook or a modification of it to generate graphics for \
published work please acknowledge the functionality provided by this notebook \
by citing the following articles and providing the download link for this \
notebook:

[1] Zurek, E.; Pickard, C.; Autschbach, J., \[OpenCurlyQuote]A Density \
Functional Study of the 13C NMR Chemical Shifts in Single-Walled Carbon \
Nanotubes with Stone-Wales Defects\[CloseCurlyQuote], J. Phys. Chem. C 2008, \
112, 11744-11750.
URL: http://dx.doi.org/10.1021/jp803180v

[2] Autschbach, J.; Zheng, S.; Schurko, R. W., \[OpenCurlyQuote]Analysis of \
Electric Field Gradient Tensors at Quadrupolar Nuclei in Common Structural \
Motifs\[CloseCurlyQuote], Concepts Magn. Reson. A 2010, 36A, 84\[Dash]126.
URL: http://dx.doi.org/10.1002/cmr.a.20155
\
\>", "Text",
 CellChangeTimes->{{3.6134046726867247`*^9, 3.613404683771162*^9}, {
  3.613404720258421*^9, 3.61340477222519*^9}, {3.6134048259468727`*^9, 
  3.613404836016098*^9}, {3.613404867233337*^9, 3.6134048749367723`*^9}, {
  3.61401988569163*^9, 3.614019938315707*^9}, {3.6140804912088947`*^9, 
  3.6140805516272297`*^9}, {3.727800501237212*^9, 3.727800508115859*^9}, {
  3.727800538213242*^9, 3.727800584852182*^9}, {3.727800728048045*^9, 
  3.7278007418763247`*^9}},ExpressionUUID->"0306a303-e91b-4665-a90b-\
2bf9e5ed1b98"],

Cell[TextData[{
 "Note : when I use a Linux version of ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 ", the next command only works properly if I start ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " and then open the notebook via its file browser, rather than double \
clicking on the notebook in one of the Linux file browsers."
}], "Text",
 CellChangeTimes->{{3.6134048913506317`*^9, 
  3.6134049694867973`*^9}},ExpressionUUID->"22fbfa9e-4d64-48af-9f50-\
c8352851fae3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.612874382965163*^9, 3.612874393565497*^9}, {
  3.613404885314075*^9, 3.6134049074630136`*^9}, {3.614080576350836*^9, 
  3.614080579682995*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"63412ef2-72d9-42a3-b3de-3bc8bef80b1a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"myBlue", " ", "=", " ", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"0", ",", 
     RowBox[{"51", "/", "255"}], ",", 
     RowBox[{"153", "/", "255"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"myGray", " ", "=", " ", 
   RowBox[{"RGBColor", "[", 
    RowBox[{
     RowBox[{"102", "/", "255"}], ",", 
     RowBox[{"102", "/", "255"}], ",", 
     RowBox[{"102", "/", "255"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"myOrange", "=", " ", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"1.0", ",", "0.588", ",", "0."}], "]"}]}], "  ", ";"}]}], "Input",
 CellChangeTimes->{{3.415739225046875*^9, 3.415739296859375*^9}, {
  3.453649235936969*^9, 3.453649236457699*^9}, {3.6140812311591654`*^9, 
  3.6140812554563513`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"ca9fd173-f797-4e0a-9c86-588e4187990f"],

Cell[TextData[{
 "Define one or more tensors via their xx, xy, ... elements. We use a scaling \
factor so that it is large enough in relation to the molecule to show up (the \
molecule data generated by ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " is in picometer, not angstrom, so the tensor to be plotted should be of \
magnitude ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["10", "2"], TraditionalForm]],ExpressionUUID->
  "2f45f771-a69a-4777-acf1-aa14bf2c7a7c"],
 "). Multiple tensors can be provided in the list {...}, separated by commas. \
In the example we plot two tensors. The surfaces can be see-through is the \
opacity values are below 1, but beware that this slows down the plot \
rendering a lot."
}], "Text",
 CellChangeTimes->{{3.41557048303125*^9, 3.415570542828125*^9}, {
  3.415638132875*^9, 3.41563819721875*^9}, {3.613405039166996*^9, 
  3.613405097077447*^9}, {3.6134051631005993`*^9, 3.613405169515965*^9}, {
  3.6140812712378035`*^9, 
  3.614081346082512*^9}},ExpressionUUID->"1a2c526d-511d-48d9-864e-\
780d9f0d6d96"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tensor", "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"100.472", ",", "91.193", ",", 
         RowBox[{"-", "4.279"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"91.193", ",", "67.572", ",", 
         RowBox[{"-", "1.544"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "4.279"}], ",", 
         RowBox[{"-", "1.544"}], ",", 
         RowBox[{"-", "2.329"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "9.788"}], ",", "20.694", ",", 
         RowBox[{"-", "108.299"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"20.694", ",", "2.741", ",", 
         RowBox[{"-", "63.712"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "108.299"}], ",", 
         RowBox[{"-", "63.712"}], ",", "93.601"}], "}"}]}], 
      "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"tensorScaling", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2"}], "}"}]}], ";", 
  RowBox[{"opacity", "=", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.4156204819014716`*^9, 3.4156205152764716`*^9}, {
   3.415620880104596*^9, 3.4156208916514716`*^9}, {3.4156210730577216`*^9, 
   3.4156211206202216`*^9}, {3.415623549260846*^9, 3.415623639729596*^9}, {
   3.4156239390577216`*^9, 3.415624019885846*^9}, {3.4156240798077216`*^9, 
   3.415624080198346*^9}, {3.415624301135846*^9, 3.4156243024014716`*^9}, {
   3.415624764948346*^9, 3.4156247660577216`*^9}, {3.415645035078125*^9, 
   3.41564503634375*^9}, {3.415645987578125*^9, 3.4156459885625*^9}, {
   3.415648972125*^9, 3.415648996890625*^9}, {3.415649037125*^9, 
   3.415649099640625*^9}, {3.415649134484375*^9, 3.415649152265625*^9}, {
   3.41564952140625*^9, 3.415649522765625*^9}, {3.4156504565*^9, 
   3.415650462546875*^9}, {3.415658788625*^9, 3.4156588036875*^9}, {
   3.41565929390625*^9, 3.41565929475*^9}, {3.4156598941875*^9, 
   3.415659931828125*^9}, {3.41566049296875*^9, 3.415660528953125*^9}, {
   3.4156612005625*^9, 3.4156612706875*^9}, {3.41566144965625*^9, 
   3.41566144971875*^9}, 3.415730352875*^9, {3.415730528265625*^9, 
   3.41573053325*^9}, {3.614019962400631*^9, 3.6140200123661213`*^9}, {
   3.614020213438195*^9, 3.614020215825617*^9}, {3.614020256763179*^9, 
   3.614020257402061*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"e4bdf65a-ef15-4253-a135-cf29e6cd138b"],

Cell["\<\
Read molecular coordinates, to be able to pick the XYZ coords of each atom \
later. We also set up a list on which atoms the tensors should be centered. \
\>", "Text",
 CellChangeTimes->{{3.41557042178125*^9, 3.415570440921875*^9}, {
  3.415620800479596*^9, 3.4156208176514716`*^9}, {3.415637962921875*^9, 
  3.415638026828125*^9}, {3.415638098890625*^9, 3.4156381245*^9}, {
  3.415659738484375*^9, 3.415659786734375*^9}, {3.415661478828125*^9, 
  3.415661480296875*^9}, {3.6140813723797235`*^9, 
  3.6140813977081723`*^9}},ExpressionUUID->"287f393e-0ca4-466a-a1a4-\
069a6634f4c1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"pickAtom", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"138", ",", "57"}], "}"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"pick", " ", "your", " ", "atom", 
    RowBox[{"(", "s", ")"}], " ", "here", " ", "\[IndentingNewLine]", 
    RowBox[{"(", 
     RowBox[{"use", " ", "a", " ", "list", " ", 
      RowBox[{"{", "...", "}"}], " ", "if", " ", "needed", " ", "and", " ", 
      "select", " ", "the", " ", "XYZ", " ", "file", " ", "on", " ", "the", 
      " ", "next", " ", 
      RowBox[{"line", ".", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"No", ".", " ", "OF"}],
        FontColor->RGBColor[1, 0, 0]]}], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["ATOMS",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["IN",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["tHIS",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["LIST",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["MUST",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["BE",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["EQUAL",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["OR",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["LESS",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["THAN",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["NUMBER",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["OF",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["TENSORS",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["DEFINED",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["ABOVE",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["AND",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["IN",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["THE",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox["CORRECT",
       FontColor->RGBColor[1, 0, 0]], 
      StyleBox[" ",
       FontColor->RGBColor[1, 0, 0]], 
      RowBox[{
       RowBox[{
        StyleBox["ORDER",
         FontColor->RGBColor[1, 0, 0]], 
        StyleBox[" ",
         FontColor->RGBColor[1, 0, 0]], "!!"}], "!"}]}], " "}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"xyzfile", "=", "\"\<nanoccapped.xyz\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"coords", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{"xyzfile", ",", " ", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"\"\<VertexTypes\>\"", ",", "\"\<VertexCoordinates\>\""}], 
       "}"}], "}"}]}], "]"}]}], " ", ";"}]}], "Input",
 CellChangeTimes->{{3.415567676796875*^9, 3.415567691453125*^9}, {
   3.415567990390625*^9, 3.415568032203125*^9}, {3.415568207859375*^9, 
   3.415568223203125*^9}, {3.415568759359375*^9, 3.415568759515625*^9}, {
   3.41557064209375*^9, 3.41557065153125*^9}, {3.415620662667096*^9, 
   3.4156206962452216`*^9}, {3.415623662698346*^9, 3.4156236627452216`*^9}, {
   3.415630922479596*^9, 3.415630929792096*^9}, {3.415630975417096*^9, 
   3.4156309773389716`*^9}, {3.41563766934375*^9, 3.4156376701875*^9}, {
   3.41563771521875*^9, 3.415637715640625*^9}, 3.41563777753125*^9, {
   3.41563804578125*^9, 3.41563806159375*^9}, {3.415659303*^9, 
   3.415659363125*^9}, {3.415659417546875*^9, 3.415659425625*^9}, {
   3.41565945703125*^9, 3.415659458484375*^9}, {3.4156595441875*^9, 
   3.415659601109375*^9}, 3.415659720421875*^9, {3.4156599885*^9, 
   3.41566002140625*^9}, {3.41566037609375*^9, 3.415660376875*^9}, {
   3.415660407328125*^9, 3.41566040753125*^9}, {3.41566118171875*^9, 
   3.41566118184375*^9}, {3.415661373359375*^9, 3.41566140996875*^9}, {
   3.415730369109375*^9, 3.415730372*^9}, {3.415730623359375*^9, 
   3.41573063165625*^9}, {3.415730679359375*^9, 3.415730692671875*^9}, {
   3.612874364173374*^9, 3.612874408683482*^9}, {3.613405128914364*^9, 
   3.6134051462345257`*^9}, {3.614020027093739*^9, 3.614020029179555*^9}, {
   3.6140200974654818`*^9, 3.614020101977363*^9}, {3.614081364942128*^9, 
   3.614081367676538*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"c4d12bf5-713c-4f04-ae82-2100af40f716"],

Cell[TextData[{
 "Below : set up the tensor functions at the locations of pickAtom and make \
the plot(s). No need to modify the next cell. Note: ",
 StyleBox["this may take a while",
  FontColor->RGBColor[1, 0, 0]],
 "\nand gets more computationally expensive if we plot several tensors and \
translucent surfaces. \nWhat exactly is plotted here? \nWe take the tensor \
elements, ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["T", "ij"], TraditionalForm]],ExpressionUUID->
  "15864f2f-f158-4836-a27e-020f98e36cd3"],
 " and multiply them with coordinates (",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      SubscriptBox["r", "1"], ",", 
      SubscriptBox["r", "2"], ",", 
      SubscriptBox["r", "3"]}], ")"}], " ", "=", " ", 
    RowBox[{"(", 
     RowBox[{"x", ",", "y", ",", "z"}], ")"}]}], TraditionalForm]],
  ExpressionUUID->"d4f2dc63-9c26-4f73-b0e1-d70e8c237530"],
 " to get a function \n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"f", "(", 
     RowBox[{"x", ",", "y", ",", "z"}], ")"}], " ", "=", " ", 
    RowBox[{
     UnderoverscriptBox["\[Sum]", 
      RowBox[{"i", ",", 
       RowBox[{"j", "=", "1"}]}], "3"], 
     RowBox[{
      SubscriptBox["r", "i"], 
      SubscriptBox["T", 
       RowBox[{"i", ",", "j"}]], 
      SubscriptBox["r", "j"]}]}]}], TraditionalForm]],ExpressionUUID->
  "e639937f-e7d3-42be-b0eb-9381ed0e6ba4"],
 "\nNext, we replace ",
 StyleBox["x",
  FontSlant->"Italic"],
 " by sin(\[Theta]) cos(\[CurlyPhi]), etc, which means we write this function \
as a function of ",
 StyleBox["r",
  FontSlant->"Italic"],
 ", \[Theta], \[CurlyPhi] divided by ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["r", "2"], " "}], TraditionalForm]],ExpressionUUID->
  "66d1ab5a-1090-4649-bac4-b1364f2e944e"],
 "because we are omitting the ",
 Cell[BoxData[
  FormBox["r", TraditionalForm]],ExpressionUUID->
  "063565e2-56eb-4e21-8aa8-9ade99dd9139"],
 " factors in the transformation from Cartesian to spherical. The result does \
not depend on ",
 StyleBox["r",
  FontSlant->"Italic"],
 ". Let this function be ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"g", "(", 
     RowBox[{"\[Theta]", ",", "\[CurlyPhi]"}], ")"}], " ", "=", " ", 
    RowBox[{
     RowBox[{"f", "(", 
      RowBox[{"r", ",", "\[Theta]", ",", "\[CurlyPhi]"}], ")"}], "/", 
     SuperscriptBox["r", "2"], 
     StyleBox[" ",
      FontSlant->"Italic"]}]}], TraditionalForm]],ExpressionUUID->
  "01fe91ce-bf84-481b-a8d2-282b5332113f"],
 ". \nNext, we set up the three components {x,y,z} of the parametric plot as\n\
\n",
 StyleBox["x = ",
  FontSlant->"Italic"],
 "g(\[Theta], \[CurlyPhi])",
 StyleBox[" ",
  FontSlant->"Italic"],
 "sin(\[Theta]) cos(\[CurlyPhi]) = g(\[Theta], \[CurlyPhi]) (x/r)",
 StyleBox["\ny = ",
  FontSlant->"Italic"],
 "g(\[Theta], \[CurlyPhi])",
 StyleBox[" ",
  FontSlant->"Italic"],
 "sin(\[Theta]) sin(\[CurlyPhi]) = g(\[Theta], \[CurlyPhi]) (y/r)\nz = g(\
\[Theta], \[CurlyPhi]) cos(\[Theta]) = g(\[Theta], \[CurlyPhi]) (z/r)\n\ni.e. \
we are plotting ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    FractionBox[
     OverscriptBox["r", "\[Rule]"], "r"], " ", 
    RowBox[{"g", "(", 
     RowBox[{"\[Theta]", ",", "\[CurlyPhi]"}], ")"}]}], TraditionalForm]],
  ExpressionUUID->"9f342578-1d22-4fda-a187-6d83be8e3ada"],
 " over the allowed range of \[Theta],\[CurlyPhi]. That is, for each pair \
\[Theta],\[CurlyPhi] we plot a vector in the direction of the point (",
 StyleBox["r,",
  FontSlant->"Italic"],
 "\[Theta]",
 StyleBox[",",
  FontSlant->"Italic"],
 "\[CurlyPhi]) with the length g(\[Theta], \[CurlyPhi]). I.e. we plot ",
 StyleBox["r = ",
  FontSlant->"Italic"],
 "g(\[Theta], \[CurlyPhi])",
 StyleBox[". ",
  FontSlant->"Italic"],
 "This is a ",
 StyleBox["polar plot",
  FontSlant->"Italic"],
 ". \nIf g(\[Theta], \[CurlyPhi]) is negative we use a different color. "
}], "Text",
 CellChangeTimes->{{3.415620583979596*^9, 3.415620611760846*^9}, {
  3.415659618109375*^9, 3.415659626046875*^9}, {3.415660426921875*^9, 
  3.4156604368125*^9}, {3.4156606225625*^9, 3.415660646390625*^9}, {
  3.42263241446875*^9, 3.422632526734375*^9}, {3.422632572421875*^9, 
  3.42263322415625*^9}, {3.4226332688125*^9, 3.42263330165625*^9}, {
  3.613406926411209*^9, 3.613406926675097*^9}, {3.614081420020958*^9, 
  3.6140814268804207`*^9}},ExpressionUUID->"4f90b1a6-22cf-4cc8-81f2-\
3d0036e681d9"],

Cell[BoxData[
 RowBox[{"tensorGraph", " ", "=", " ", 
  RowBox[{"Table", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tensorCenter", " ", "=", " ", 
         RowBox[{"coords", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", 
            RowBox[{"pickAtom", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}]}], " ", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"opacityValue", "=", 
         RowBox[{"opacity", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"f", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"tensorScaling", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "  ", 
             RowBox[{
              RowBox[{"(", "\[NoBreak]", GridBox[{
                 {"x", "y", "z"}
                }], "\[NoBreak]", ")"}], "  ", ".", " ", 
              RowBox[{"tensor", "[", 
               RowBox[{"[", "i", "]"}], "]"}], " ", ".", "   ", 
              RowBox[{"(", "\[NoBreak]", GridBox[{
                 {"x"},
                 {"y"},
                 {"z"}
                }], "\[NoBreak]", ")"}]}]}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "  ", "/.", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x", " ", "\[Rule]", " ", 
             RowBox[{
              RowBox[{"Sin", "[", "t", "]"}], " ", 
              RowBox[{"Cos", "[", "p", "]"}]}]}], ",", " ", 
            RowBox[{"y", " ", "\[Rule]", " ", 
             RowBox[{
              RowBox[{"Sin", "[", "t", "]"}], " ", 
              RowBox[{"Sin", "[", "p", "]"}]}]}], ",", " ", 
            RowBox[{"z", " ", "\[Rule]", " ", 
             RowBox[{"Cos", "[", "t", "]"}]}]}], "}"}]}]}]}], 
       "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"g", "[", 
         RowBox[{"t_", ",", "p_"}], "]"}], " ", ":=", " ", 
        RowBox[{"f", "  ", "/.", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", " ", "\[Rule]", " ", 
            RowBox[{
             RowBox[{"Sin", "[", "t", "]"}], " ", 
             RowBox[{"Cos", "[", "p", "]"}]}]}], ",", " ", 
           RowBox[{"y", " ", "\[Rule]", " ", 
            RowBox[{
             RowBox[{"Sin", "[", "t", "]"}], " ", 
             RowBox[{"Sin", "[", "p", "]"}]}]}], ",", " ", 
           RowBox[{"z", " ", "\[Rule]", " ", 
            RowBox[{"Cos", "[", "t", "]"}]}]}], "}"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"g", " ", "=", " ", 
          RowBox[{"Compile", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"t", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", ",", "_Real"}], "}"}]}], "}"}], ",", " ", "f"}], 
           "  ", "]"}]}], ";"}], " ", "*)"}], 
       RowBox[{"(*", " ", 
        RowBox[{
        "not", " ", "sure", " ", "if", " ", "compiling", " ", "makes", " ", 
         "this", " ", "faster", " ", "or", " ", "not"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ParametricPlot3D", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"g", "[", 
                RowBox[{"t", ",", "p"}], "]"}], " ", ">", " ", "0"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"g", "[", 
                  RowBox[{"t", ",", "p"}], "]"}], "  ", 
                 RowBox[{"Sin", "[", "t", "]"}], " ", 
                 RowBox[{"Cos", "[", "p", "]"}]}], ",", 
                RowBox[{
                 RowBox[{"g", "[", 
                  RowBox[{"t", ",", "p"}], "]"}], "  ", 
                 RowBox[{"Sin", "[", "t", "]"}], " ", 
                 RowBox[{"Sin", "[", "p", "]"}]}], ",", " ", 
                RowBox[{
                 RowBox[{"g", "[", 
                  RowBox[{"t", ",", "p"}], "]"}], "  ", 
                 RowBox[{"Cos", "[", "t", "]"}]}]}], " ", "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], " ", "+", 
            " ", "tensorCenter"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"g", "[", 
                RowBox[{"t", ",", "p"}], "]"}], " ", "<", " ", "0"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"g", "[", 
                  RowBox[{"t", ",", "p"}], "]"}], "  ", 
                 RowBox[{"Sin", "[", "t", "]"}], " ", 
                 RowBox[{"Cos", "[", "p", "]"}]}], ",", 
                RowBox[{
                 RowBox[{"g", "[", 
                  RowBox[{"t", ",", "p"}], "]"}], "  ", 
                 RowBox[{"Sin", "[", "t", "]"}], " ", 
                 RowBox[{"Sin", "[", "p", "]"}]}], ",", " ", 
                RowBox[{
                 RowBox[{"g", "[", 
                  RowBox[{"t", ",", "p"}], "]"}], "  ", 
                 RowBox[{"Cos", "[", "t", "]"}]}]}], " ", "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "]"}], " ", "+", 
            " ", "tensorCenter"}]}], "\[IndentingNewLine]", "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"t", ",", "0", ",", " ", "Pi"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"p", ",", " ", "0", ",", " ", 
           RowBox[{"2", " ", "Pi"}]}], "}"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
         RowBox[{"AxesLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
           "\"\<x\>\"", ",", " ", "\"\<y\>\"", ",", " ", "\"\<z\>\""}], 
           "}"}]}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"myBlue", ",", 
              RowBox[{"Opacity", "[", "opacityValue", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"myOrange", ",", 
              RowBox[{"Opacity", "[", "opacityValue", "]"}]}], "}"}]}], 
           "}"}]}], ",", " ", 
         RowBox[{"Mesh", "\[Rule]", "Full"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "pickAtom", "]"}]}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.41554792759375*^9, 3.41554793309375*^9}, {
   3.415548279515625*^9, 3.415548279625*^9}, {3.415548317703125*^9, 
   3.4155483199375*^9}, {3.41554854771875*^9, 3.415548549546875*^9}, {
   3.41556777490625*^9, 3.415567780734375*^9}, {3.415567810890625*^9, 
   3.415567824375*^9}, 3.4155678644375*^9, {3.4155691211875*^9, 
   3.4155691215625*^9}, {3.41556927665625*^9, 3.41556927921875*^9}, {
   3.415569736125*^9, 3.415569761890625*^9}, {3.415620528823346*^9, 
   3.4156205780889716`*^9}, {3.415620619979596*^9, 3.4156206372452216`*^9}, {
   3.415620841885846*^9, 3.415620854948346*^9}, {3.415620894010846*^9, 
   3.4156209140264716`*^9}, {3.415645096390625*^9, 3.41564509965625*^9}, {
   3.415649016703125*^9, 3.41564902440625*^9}, {3.415649157875*^9, 
   3.4156491793125*^9}, {3.415649211859375*^9, 3.415649214109375*^9}, {
   3.415649525875*^9, 3.41564954434375*^9}, {3.415649937203125*^9, 
   3.415649940609375*^9}, {3.4156502855625*^9, 3.415650359609375*^9}, {
   3.415650410390625*^9, 3.41565043503125*^9}, {3.41565883534375*^9, 
   3.415658873203125*^9}, {3.41565890803125*^9, 3.415658927421875*^9}, {
   3.415658979171875*^9, 3.4156590009375*^9}, {3.415659047625*^9, 
   3.41565905171875*^9}, {3.415659090046875*^9, 3.415659166578125*^9}, {
   3.415659471171875*^9, 3.4156594720625*^9}, {3.415659979921875*^9, 
   3.415659982640625*^9}, {3.415660041421875*^9, 3.415660096421875*^9}, {
   3.415660197859375*^9, 3.415660292421875*^9}, {3.4156605531875*^9, 
   3.415660613828125*^9}, {3.415660659125*^9, 3.415660664921875*^9}, {
   3.415660713796875*^9, 3.415660724765625*^9}, {3.415661455875*^9, 
   3.4156614569375*^9}, {3.415739305484375*^9, 3.415739316515625*^9}, {
   3.41573938009375*^9, 3.415739390890625*^9}, {3.415739421203125*^9, 
   3.415739421875*^9}, {3.4160720380625*^9, 3.41607203978125*^9}, {
   3.416092899171875*^9, 3.41609299725*^9}, {3.416093037015625*^9, 
   3.41609306315625*^9}, {3.416093155578125*^9, 3.416093267984375*^9}, {
   3.416093337546875*^9, 3.416093349140625*^9}, {3.416093424890625*^9, 
   3.416093446546875*^9}, {3.453649241671231*^9, 3.453649241761932*^9}, {
   3.612878320023233*^9, 3.612878394804562*^9}, {3.6128784483474617`*^9, 
   3.612878485483526*^9}, {3.613320815948489*^9, 3.613320833855006*^9}, {
   3.613405199484103*^9, 3.613405206264399*^9}, {3.613405288043407*^9, 
   3.61340531785679*^9}, {3.6134054202845182`*^9, 3.6134054211990547`*^9}, {
   3.61402022063339*^9, 3.614020253302093*^9}, {3.773069305066703*^9, 
   3.7730693071673517`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"31fa2e36-2024-4214-923f-fd68a2006fd2"],

Cell["\<\
Create a plot for the PAS.
Set labelPAS to True to get the principal values printed next to the \
arrowheads, or False to disable printing the numbers. The \
\[OpenCurlyQuote]pscale\[CloseCurlyQuote] array allows to scale the arrows \
globally and individually to make for an appealing graph\
\>", "Text",
 CellChangeTimes->{{3.613320665722513*^9, 3.613320676327125*^9}, {
   3.61340576189135*^9, 3.613405792794462*^9}, {3.61340683715552*^9, 
   3.613406868587253*^9}, {3.614020777905179*^9, 3.614020804131415*^9}, {
   3.614021134724123*^9, 3.614021138130025*^9}, 
   3.614081473287265*^9},ExpressionUUID->"57658eb8-2dbc-415a-b8bb-\
aec5f66b5eba"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{"Eigenvalues", "[", 
     RowBox[{"tensor", "[", 
      RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", "1", ",", 
     RowBox[{"Length", "[", "pickAtom", "]"}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.61402043607724*^9, 
  3.614020471730907*^9}},ExpressionUUID->"c68813ee-d31d-4e51-8073-\
5bd0cb10f4a4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"176.78876772564732`", ",", 
   RowBox[{"-", "9.01206020557265`"}], ",", 
   RowBox[{"-", "2.061707520074458`"}]}], "}"}]], "Print",
 CellChangeTimes->{3.614020473884572*^9, 
  3.6140814773810673`*^9},ExpressionUUID->"274aadcd-0494-4fed-87fd-\
bc8c0c9ceb3c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"185.1528117377154`", ",", 
   RowBox[{"-", "82.11942000332603`"}], ",", 
   RowBox[{"-", "16.47939173438937`"}]}], "}"}]], "Print",
 CellChangeTimes->{3.614020473884572*^9, 
  3.6140814773966923`*^9},ExpressionUUID->"b7d59229-04bc-4205-98f3-\
3b44199ece73"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pscale", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"500", ",", "500"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"textOffset", "=", 
   RowBox[{"{", 
    RowBox[{"20", ",", "20", ",", "20"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"labelPAS", "=", "False"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"pasGraph", "=", 
  RowBox[{"Table", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tc", " ", "=", " ", 
         RowBox[{"coords", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", 
            RowBox[{"pickAtom", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}]}], " ", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Eigenvectors", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "/", "2"}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tensor", "[", 
              RowBox[{"[", "i", "]"}], "]"}], " ", "+", " ", 
             RowBox[{"Transpose", "[", 
              RowBox[{"tensor", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ")"}]}], "]"}]}], ",",
         "\[IndentingNewLine]", 
        RowBox[{"ct", " ", "=", " ", 
         RowBox[{"Transpose", "[", "c", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"pv", " ", "=", " ", 
         RowBox[{"Eigenvalues", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "/", "2"}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"tensor", "[", 
              RowBox[{"[", "i", "]"}], "]"}], " ", "+", " ", 
             RowBox[{"Transpose", "[", 
              RowBox[{"tensor", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ")"}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"labelPAS", ",", "\[IndentingNewLine]", 
        RowBox[{"Graphics3D", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
             RowBox[{"Arrow", "[", 
              RowBox[{"Tube", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"tc", ",", "\[IndentingNewLine]", 
                  RowBox[{"tc", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "*", " ", 
                    RowBox[{"pscale", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}]}], " ", 
                 RowBox[{"(*", " ", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], " ", "*)"}], 
                 "\[IndentingNewLine]", "}"}], ",", "2"}], "]"}], "]"}]}], 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
             RowBox[{"Arrow", "[", 
              RowBox[{"Tube", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"tc", ",", "\[IndentingNewLine]", 
                  RowBox[{"tc", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "*", " ", 
                    RowBox[{"pscale", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}]}], "  ", 
                 RowBox[{"(*", "  ", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], " ", "*)"}], 
                 "\[IndentingNewLine]", "}"}], ",", "2"}], "]"}], "]"}]}], 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
             RowBox[{"Arrow", "[", 
              RowBox[{"Tube", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"tc", ",", "\[IndentingNewLine]", 
                  RowBox[{"tc", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "*", " ", 
                    RowBox[{"pscale", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}]}], "  ", 
                 RowBox[{"(*", " ", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], " ", "*)"}], 
                 "\[IndentingNewLine]", "}"}], ",", "2"}], "]"}], "]"}]}], 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"pv", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"tc", "+", 
                RowBox[{
                 RowBox[{"c", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "*", " ", 
                 RowBox[{"pscale", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], " ", "+", 
                RowBox[{
                 RowBox[{"Sign", "[", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "textOffset"}]}], 
               ",", 
               RowBox[{"Background", "\[Rule]", "White"}]}], "]"}]}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"pv", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"tc", "+", 
                RowBox[{
                 RowBox[{"c", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "*", " ", 
                 RowBox[{"pscale", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], " ", "+", 
                RowBox[{
                 RowBox[{"Sign", "[", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "textOffset"}]}], 
               ",", 
               RowBox[{"Background", "\[Rule]", "White"}]}], "]"}]}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"pv", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", 
               RowBox[{"tc", "+", 
                RowBox[{
                 RowBox[{"c", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "*", " ", 
                 RowBox[{"pscale", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], " ", "+", 
                RowBox[{
                 RowBox[{"Sign", "[", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "]"}], "textOffset"}]}], 
               ",", 
               RowBox[{"Background", "\[Rule]", "White"}]}], "]"}]}], "}"}]}],
           "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Graphics3D", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
             RowBox[{"Arrow", "[", 
              RowBox[{"Tube", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"tc", ",", "\[IndentingNewLine]", 
                  RowBox[{"tc", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "*", " ", 
                    RowBox[{"pscale", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}]}], " ", 
                 RowBox[{"(*", " ", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], " ", "*)"}], 
                 "\[IndentingNewLine]", "}"}], ",", "2"}], "]"}], "]"}]}], 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
             RowBox[{"Arrow", "[", 
              RowBox[{"Tube", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"tc", ",", "\[IndentingNewLine]", 
                  RowBox[{"tc", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "*", " ", 
                    RowBox[{"pscale", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}]}], " ", 
                 RowBox[{"(*", " ", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], " ", "*)"}], 
                 "\[IndentingNewLine]", "}"}], ",", "2"}], "]"}], "]"}]}], 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pv", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], " ", ">", " ", "0"}], ",", 
               "Green", ",", "Red"}], "]"}], ",", 
             RowBox[{"Arrowheads", "[", "Small", "]"}], ",", 
             RowBox[{"Arrow", "[", 
              RowBox[{"Tube", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"tc", ",", "\[IndentingNewLine]", 
                  RowBox[{"tc", " ", "+", " ", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "*", " ", 
                    RowBox[{"pscale", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}]}], "  ", 
                 RowBox[{"(*", " ", 
                  RowBox[{"pv", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], " ", "*)"}], 
                 "\[IndentingNewLine]", "}"}], ",", "2"}], "]"}], "]"}]}], 
            "}"}]}], "}"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "[", "pickAtom", "]"}]}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQA2IQ/Yz1mhzbm1eO3w6mGYJokTuapiB6XpS6JYhuefLf
BkQv+n/WFkQzxp12BNFV71e4gehtlbN8QHRHpGwwiH7mGxcNom/lFYDpNPb5
2SBa50VCG4i+xCHdA6K5is6CaeOErRNAdKihwmQQHfWvbAOIXiaRvhFMf5m5
HUQfusy+B0RL70w9AqKdFG6eBdFMrc6XQbTc41ownfE2Otro7SvHn3seg+nv
chaJIHrH7hQw/eGmbiqItvtclQGi+8TUCkA03xOmChAdNlu0HkTPij7aCKI/
zjXrBvOFLvaAaNFHPRNBtM7slikgWk8peROIvr80fz+IThPYfhhE/1t+8DiI
BgClHrnK
  "],
 CellLabel->"In[14]:=",ExpressionUUID->"a1061190-a405-41ac-b428-a0d4eb450f17"],

Cell[TextData[{
 "Import the XYZ file again, and combine the molecule plot with the tensor \
plot(s) located on the picked atom(s). The variables \"vp\" and \"vv\" have \
been introduced according to the ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " tricks shown at http://web.ift.uib.no/~szhorvat/mmatricks.php to be able \
to save the graphics as a reasonably high quality bitmap with the same \
viewpoint as that selected during the interactive rotation of the figure. "
}], "Text",
 CellChangeTimes->{{3.41565968084375*^9, 3.415659701703125*^9}, {
   3.41565980378125*^9, 3.415659811328125*^9}, 
   3.6140814930062675`*^9},ExpressionUUID->"3b69345c-bae5-4451-b950-\
fc768c7620d5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"molGraph", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{"xyzfile", ",", " ", "\"\<XYZ\>\""}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vp", "=", 
    RowBox[{"ViewPoint", "/.", 
     RowBox[{"Options", "[", "Graphics3D", "]"}]}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vv", "=", 
   RowBox[{"ViewVertical", "/.", 
    RowBox[{"Options", "[", "Graphics3D", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vp", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"1.3", ",", 
     RowBox[{"-", "2.4"}], ",", "2"}], "}"}]}], ";", " ", 
  RowBox[{"vv", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"tensorplot", " ", "=", " ", 
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"molGraph", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"pasGraph", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "pickAtom", "]"}]}], "}"}]}], "]"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"tensorGraph", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "pickAtom", "]"}]}], "}"}]}], "]"}]}], "}"}],
     ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
    RowBox[{"ViewPoint", "\[Rule]", 
     RowBox[{"Dynamic", "[", "vp", "]"}]}], ",", " ", 
    RowBox[{"ViewVertical", "\[Rule]", 
     RowBox[{"Dynamic", "[", "vv", "]"}]}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.415567676796875*^9, 3.415567691453125*^9}, {
   3.415567990390625*^9, 3.415568032203125*^9}, {3.415568207859375*^9, 
   3.415568223203125*^9}, {3.415568759359375*^9, 3.415568759515625*^9}, {
   3.41557064209375*^9, 3.41557065153125*^9}, {3.415620662667096*^9, 
   3.4156206962452216`*^9}, {3.415623662698346*^9, 3.4156236627452216`*^9}, {
   3.415630922479596*^9, 3.415630929792096*^9}, {3.415630975417096*^9, 
   3.4156309773389716`*^9}, {3.41563766934375*^9, 3.4156376701875*^9}, {
   3.41563771521875*^9, 3.415637715640625*^9}, 3.41563777753125*^9, {
   3.41563804578125*^9, 3.41563806159375*^9}, {3.415659303*^9, 
   3.415659359390625*^9}, {3.41565966234375*^9, 3.41565967821875*^9}, {
   3.415660131265625*^9, 3.4156601725625*^9}, {3.415739569953125*^9, 
   3.415739583125*^9}, {3.41573963015625*^9, 3.415739657421875*^9}, {
   3.4157397174375*^9, 3.415739718125*^9}, {3.41607220609375*^9, 
   3.41607223896875*^9}, {3.613321817134325*^9, 3.613321818932631*^9}, {
   3.613405899354682*^9, 3.613405922729775*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"14c795a5-ce20-4dbf-b526-30bfab8113fd"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{
  3.415739799625*^9, 3.415754735765625*^9, 3.416072061390625*^9, {
   3.4160722131875*^9, 
   3.416072242515625*^9}},ExpressionUUID->"919c9ea1-014b-4fb3-a0ec-\
77df91f50056"],

Cell["\<\
After finding the best viewpoint for the graphics it can be exported with the \
command below. The viewpoint will be the same as that after interactive \
rotation of the graphics \"tensorplot\" above\
\>", "Text",
 CellChangeTimes->{{3.4156382219375*^9, 3.415638297125*^9}, {
  3.41564497628125*^9, 
  3.415644977078125*^9}},ExpressionUUID->"f764de2f-ffcf-429f-ae3a-\
a2f688b50eb6"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"vp", ";", "vv", ";", " ", 
  RowBox[{"Export", "[", 
   RowBox[{
   "\"\<tensorplot.png\>\"", ",", "tensorplot", ",", "\"\<PNG\>\"", ",", 
    RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], "  "}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQfbXQPXd90UvHq4W/8sH0x7UtEL5TK4T/rRNCl3dB
xLmnQOiP0yB05jyIfMkiCP/bMgi9dQ2EtngBobvfg+hbEZt6joPpmj4QzcBw
7e55EN0gfw9MM0z4CqGXQ+gGH7YLYH4klF6qDKYbTkDpuP0XwXQtlM5MuQxW
VwahG24rcxaDaA4VCP3/62IQzcD3DURvOLb51za9V47vZR+B6X7zVzdYXr9y
XP3S7CaITg50eg6iXz2tAtMSYv2KrEC6p3krmL5y8J0PiPbImOsPole3eYaC
6HjT1gQQbRc7ZesdIP3A5geYTozXTmZ788rxQGsNmAYA5AHPag==
  "],ExpressionUUID->"2c2328b5-eb33-4a18-858c-cd02bdd50601"],

Cell[BoxData["\<\"tensorplot.png\"\>"], "Output",
 CellChangeTimes->{
  3.41563781303125*^9, {3.415637850328125*^9, 3.415637869765625*^9}, 
   3.415637904734375*^9, {3.4156379366875*^9, 3.4156379499375*^9}, {
   3.41563807625*^9, 3.41563808609375*^9}, 3.415638317859375*^9, 
   3.415638676625*^9, {3.415638761453125*^9, 3.41563878803125*^9}, 
   3.41564161721875*^9, 3.415645303796875*^9, 3.415659841390625*^9, 
   3.415730765328125*^9, 3.415739484875*^9, 3.415739596796875*^9, 
   3.41573967478125*^9, 3.415739806015625*^9, 3.4157547395625*^9, 
   3.41575501159375*^9, 3.4157550453125*^9, 3.416072100296875*^9, 
   3.4160722644375*^9, 3.41607236215625*^9, 3.416073252015625*^9, 
   3.41609437846875*^9, {3.6128786394783382`*^9, 3.612878665920096*^9}, 
   3.612879087193412*^9, 3.612879173117988*^9, 3.612879489832733*^9, 
   3.612879534827971*^9, {3.612879567157712*^9, 3.612879626786325*^9}, 
   3.61340599436065*^9, 3.613406747058579*^9, 3.614020878695324*^9, 
   3.614020967344112*^9, 3.6140212216892967`*^9, 
   3.6140815700072527`*^9},ExpressionUUID->"4a46a968-fa1e-4532-b61a-\
859363cd61b7"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{890, 725},
WindowMargins->{{Automatic, 672}, {Automatic, 286}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
ShowSelection->True,
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 441, 10, 123, "Subsubsection",ExpressionUUID->"66c2ffc7-bd8c-4984-b79e-6eec20a09d77"],
Cell[1024, 34, 1812, 33, 426, "Text",ExpressionUUID->"0306a303-e91b-4665-a90b-2bf9e5ed1b98"],
Cell[2839, 69, 486, 12, 81, "Text",ExpressionUUID->"22fbfa9e-4d64-48af-9f50-c8352851fae3"],
Cell[3328, 83, 367, 7, 31, "Input",ExpressionUUID->"63412ef2-72d9-42a3-b3de-3bc8bef80b1a"],
Cell[3698, 92, 868, 21, 78, "Input",ExpressionUUID->"ca9fd173-f797-4e0a-9c86-588e4187990f"],
Cell[4569, 115, 1054, 22, 127, "Text",ExpressionUUID->"1a2c526d-511d-48d9-864e-780d9f0d6d96"],
Cell[5626, 139, 2773, 59, 331, "Input",ExpressionUUID->"e4bdf65a-ef15-4253-a135-cf29e6cd138b"],
Cell[8402, 200, 591, 10, 58, "Text",ExpressionUUID->"287f393e-0ca4-466a-a1a4-069a6634f4c1"],
Cell[8996, 212, 5201, 136, 170, "Input",ExpressionUUID->"c4d12bf5-713c-4f04-ae82-2100af40f716"],
Cell[14200, 350, 4360, 123, 449, "Text",ExpressionUUID->"4f90b1a6-22cf-4cc8-81f2-3d0036e681d9"],
Cell[18563, 475, 9327, 202, 567, "Input",ExpressionUUID->"31fa2e36-2024-4214-923f-fd68a2006fd2"],
Cell[27893, 679, 658, 12, 81, "Text",ExpressionUUID->"57658eb8-2dbc-415a-b8bb-aec5f66b5eba"],
Cell[CellGroupData[{
Cell[28576, 695, 441, 12, 31, "Input",ExpressionUUID->"c68813ee-d31d-4e51-8073-5bd0cb10f4a4"],
Cell[CellGroupData[{
Cell[29042, 711, 297, 7, 25, "Print",ExpressionUUID->"274aadcd-0494-4fed-87fd-bc8c0c9ceb3c"],
Cell[29342, 720, 297, 7, 25, "Print",ExpressionUUID->"b7d59229-04bc-4205-98f3-3b44199ece73"]
}, Open  ]]
}, Open  ]],
Cell[29666, 731, 12715, 300, 1067, "Input",ExpressionUUID->"a1061190-a405-41ac-b428-a0d4eb450f17"],
Cell[42384, 1033, 693, 13, 104, "Text",ExpressionUUID->"3b69345c-bae5-4451-b950-fc768c7620d5"],
Cell[43080, 1048, 2795, 64, 193, "Input",ExpressionUUID->"14c795a5-ce20-4dbf-b526-30bfab8113fd"],
Cell[45878, 1114, 221, 5, 31, "Input",ExpressionUUID->"919c9ea1-014b-4fb3-a0ec-77df91f50056"],
Cell[46102, 1121, 392, 8, 58, "Text",ExpressionUUID->"f764de2f-ffcf-429f-ae3a-a2f688b50eb6"],
Cell[CellGroupData[{
Cell[46519, 1133, 696, 13, 31, "Input",ExpressionUUID->"2c2328b5-eb33-4a18-858c-cd02bdd50601"],
Cell[47218, 1148, 1098, 17, 35, "Output",ExpressionUUID->"4a46a968-fa1e-4532-b61a-859363cd61b7"]
}, Open  ]]
}, Open  ]]
}
]
*)

